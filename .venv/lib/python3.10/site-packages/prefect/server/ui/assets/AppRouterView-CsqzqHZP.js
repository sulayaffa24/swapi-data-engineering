import{d as B,M as O,ae as U,V as R,h as c,c as g,o as m,i as n,k as t,D as S,l as V,a as w,n as D,m as e,t as q,L as j,de as K,df as L,K as F,g as J,cB as W,dg as z,dh as Q,di as l,bg as i,I as Y,dj as G,j as H,dk as Z,dl as X,c9 as E,aJ as $,by as ee,dm as te,dn as oe,dp as ne,r as se,aw as ae,dq as le,aS as x,dr as ie,ds as re,dt as ue,du as ce}from"./index-B2Mqn-oh.js";import{u as me,c as pe}from"./useCan-UjdHjQ2R.js";import{u as de,U as _e,a as fe,c as ve,p as ge}from"./usePrefectApi-CVNyESB6.js";import"./mapper-Dc-EvePY.js";const ye={class:"flex gap-x-2 items-center"},we={key:0,class:"text-sm italic"},ke="http://prefect.io/slack?utm_source=oss&utm_medium=oss&utm_campaign=oss_popup&utm_term=none&utm_content=none",T="join-the-community-modal",he="https://getform.io/f/eapderva",be=B({__name:"JoinTheCommunityModal",props:{showModal:{type:Boolean},showModalModifiers:{}},emits:["update:showModal"],setup(a){const s=O(a,"showModal"),u=U(!1),r=U(),{validate:k,state:d}=R(r,[K("Email"),L("Email")]),f=U(!1),v=U("");async function h(){if(await k()){v.value="",f.value=!0;try{await fetch(he,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.value}),redirect:"manual"}),s.value=!1,j("Successfully subscribed","success")}catch(b){v.value="An error occurred. Please try again.",console.error(b)}finally{f.value=!1}}}return(b,o)=>{const p=c("p-button"),y=c("p-divider"),_=c("p-text-input"),M=c("p-label"),P=c("p-form"),A=c("p-message"),I=c("p-modal");return m(),g(I,{"show-modal":s.value,"onUpdate:showModal":o[2]||(o[2]=C=>s.value=C),title:"Join the Prefect Community"},{header:n(()=>[...o[3]||(o[3]=[V("h2",null,"Join the Community",-1)])]),default:n(()=>[o[5]||(o[5]=V("p",null," Connect with 25k+ engineers scaling Python with Prefect. Show us your work and be the first to know about new Prefect features. ",-1)),V("div",ye,[t(p,{primary:"",icon:"Slack",to:ke,target:"_blank",onClick:o[0]||(o[0]=C=>u.value=!0)},{default:n(()=>[...o[4]||(o[4]=[S(" Join us on Slack ",-1)])]),_:1}),u.value?(m(),D("span",we," Thanks for joining our community! ")):w("",!0)]),t(y,{class:"-my-3"}),t(P,{id:T,onSubmit:h},{default:n(()=>[t(M,{label:"Notify me about Prefect updates",state:e(d),message:e(d).error},{default:n(({id:C})=>[t(_,{id:C,modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=N=>r.value=N),placeholder:"hello@prefect.io",state:e(d)},null,8,["id","modelValue","state"])]),_:1},8,["state","message"])]),_:1}),v.value?(m(),g(A,{key:0,error:""},{default:n(()=>[S(q(v.value),1)]),_:1})):w("",!0)]),cancel:n(C=>[t(p,{class:"sm:order-first",onClick:C.close},{default:n(()=>[...o[6]||(o[6]=[S(" Skip ",-1)])]),_:1},8,["onClick"])]),actions:n(()=>[t(p,{primary:"",type:"submit",form:T,loading:f.value},{default:n(()=>[...o[7]||(o[7]=[S(" Sign up ",-1)])]),_:1},8,["loading"])]),_:1},8,["show-modal"])}}}),Ce={key:0,href:"https://www.prefect.io/cloud-vs-oss?utm_source=oss&utm_medium=oss&utm_campaign=oss&utm_term=none&utm_content=none",target:"_blank"},Se=B({__name:"ContextSidebar",async setup(a){let s,u;const r=me(),k=de(),d=([s,u]=F(()=>k.admin.getSettings()),s=await s,u(),s),f=J(()=>d.server.ui.show_promotional_content);localStorage.setItem("prefect-show-promotional-content",String(f.value));const v=J(()=>r.read.work_pool),{showModal:h,open:b}=W(),{value:o}=z("local","join-the-community-modal-dismissed",!1);function p(y){h.value=y,y||(o.value=!0)}return(y,_)=>{const M=c("p-icon"),P=c("router-link"),A=c("p-button");return m(),g(e(Q),{class:"context-sidebar"},{header:n(()=>[t(P,{to:e(i).root(),class:"context-sidebar__logo-link"},{default:n(()=>[t(M,{icon:"Prefect",class:"context-sidebar__logo-icon"})]),_:1},8,["to"])]),footer:n(()=>[f.value?(m(),D("a",Ce,[t(e(l),null,{default:n(()=>[_[1]||(_[1]=V("div",null," Ready to scale? ",-1)),t(A,{primary:"",small:"",class:"context-sidebar__upgade-button"},{default:n(()=>[..._[0]||(_[0]=[S(" Upgrade ",-1)])]),_:1})]),_:1})])):w("",!0),f.value?(m(),g(e(l),{key:1,onClick:e(b)},{default:n(()=>[_[2]||(_[2]=S(" Join the Community ",-1)),t(be,{"show-modal":e(h)||!e(o),"onUpdate:showModal":p},null,8,["show-modal"])]),_:1},8,["onClick"])):w("",!0),t(e(l),{title:"Settings",to:e(i).settings()},null,8,["to"])]),default:n(()=>[t(e(l),{title:"Dashboard",to:e(i).dashboard()},null,8,["to"]),t(e(l),{title:"Runs",to:e(i).runs()},null,8,["to"]),t(e(l),{title:"Flows",to:e(i).flows()},null,8,["to"]),t(e(l),{title:"Deployments",to:e(i).deployments()},null,8,["to"]),v.value?(m(),g(e(l),{key:0,title:"Work Pools",to:e(i).workPools()},null,8,["to"])):w("",!0),v.value?w("",!0):(m(),g(e(l),{key:1,title:"Work Queues",to:e(i).workQueues()},null,8,["to"])),t(e(l),{title:"Blocks",to:e(i).blocks()},null,8,["to"]),t(e(l),{title:e(Y).info.variables,to:e(i).variables()},null,8,["title","to"]),t(e(l),{title:"Automations",to:e(i).automations()},null,8,["to"]),t(e(l),{title:"Event Feed",to:e(i).events()},null,8,["to"]),t(e(l),{title:"Concurrency",to:e(i).concurrencyLimits()},null,8,["to"])]),_:1})}}});async function Me(){const a=await _e.get("apiUrl"),s={baseUrl:a};return a.startsWith("/")&&G(),{config:s}}function Pe(){const a=H(fe.getFeatureFlags,[]),s=J(()=>[...Z,...a.response??[]]),u=X(s),r=J(()=>a.loading);return{can:u,pending:r}}function xe(){const a=U(!1);function s(){a.value=!a.value}function u(){a.value=!0}function r(){a.value=!1}return{mobileMenuOpen:a,open:u,close:r,toggle:s}}const Ue={class:"app-router-view"},$e=B({__name:"AppRouterView",async setup(a){let s,u;const{can:r}=Pe(),{config:k}=([s,u]=F(()=>Me()),s=await s,u(),s),d=ve(k),f=ue();x(pe,r),x(ie,r),x(ge,d),x(re,d),x(ce,f),d.admin.authCheck().then(p=>{p==401?E.currentRoute.value.name!=="login"&&(j("Authentication failed.","error",{timeout:!1}),E.push({name:"login",query:{redirect:E.currentRoute.value.fullPath}})):d.health.isHealthy().then(y=>{y||j(`Can't connect to Server API at ${k.baseUrl}. Check that it's accessible from your machine.`,"error",{timeout:!1})})});const{mobileMenuOpen:v,toggle:h,close:b}=xe(),o=J(()=>$.lg||v.value);return ee(()=>document.body.classList.toggle("body-scrolling-disabled",o.value&&!$.lg)),(p,y)=>{const _=c("router-link"),M=c("p-button");return m(),D("div",Ue,[!e($).lg&&!p.$route.meta.public?(m(),g(e(oe),{key:0,class:"app-router-view__mobile-menu"},{"upper-links":n(()=>[t(_,{to:e(i).root()},{default:n(()=>[t(e(te),{icon:"Prefect",class:"app-router-view__prefect-icon"})]),_:1},8,["to"])]),"bottom-links":n(()=>[t(M,{small:"",icon:"Bars3Icon",class:"app-router-view__menu-icon",onClick:e(h)},null,8,["onClick"])]),_:1})):w("",!0),o.value&&!p.$route.meta.public?(m(),g(Se,{key:1,class:"app-router-view__sidebar",onClick:e(b)},null,8,["onClick"])):w("",!0),t(e(le),{class:ae(["app-router-view__view",{"app-router-view__view--public":p.$route.meta.public}])},{default:n(({Component:P})=>[t(ne,{name:"app-router-view-fade",mode:"out-in"},{default:n(()=>[(m(),g(se(P)))]),_:2},1024)]),_:1},8,["class"])])}}});export{$e as default};
//# sourceMappingURL=AppRouterView-CsqzqHZP.js.map
